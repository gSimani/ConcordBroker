<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Testing Supabase Connection</h1>
    <div id="status">Checking...</div>
    <div id="results"></div>
    
    <script>
        // Supabase credentials from your .env
        const supabaseUrl = 'https://pmispwtdngkcmsrsjwbp.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBtaXNwd3RkbmdrY21zcnNqd2JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NTY5NTgsImV4cCI6MjA3MjUzMjk1OH0.YvWR1NkVByTY10Vzpzt4jMtMjBszD_BOCsQDBfG951A';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseAnonKey);
        
        async function testConnection() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test 1: Check if table exists
                statusDiv.innerHTML = 'Testing florida_parcels table...';
                const { data, error } = await supabaseClient
                    .from('florida_parcels')
                    .select('parcel_id, phy_addr1, phy_city, owner_name')
                    .limit(3);
                
                if (error) {
                    statusDiv.innerHTML = `❌ Error: ${error.message}`;
                    resultsDiv.innerHTML = `<pre>${JSON.stringify(error, null, 2)}</pre>`;
                    
                    // If table doesn't exist, show SQL to create it
                    if (error.code === '42P01') {
                        resultsDiv.innerHTML += `
                            <h2>Table doesn't exist. Run this SQL in Supabase:</h2>
                            <pre style="background: #f0f0f0; padding: 10px; overflow-x: auto;">
CREATE TABLE florida_parcels (
    id BIGSERIAL PRIMARY KEY,
    parcel_id VARCHAR(50) UNIQUE NOT NULL,
    phy_addr1 VARCHAR(255),
    phy_city VARCHAR(100),
    phy_zipcd VARCHAR(10),
    owner_name VARCHAR(255),
    taxable_value FLOAT,
    year_built INTEGER,
    total_living_area FLOAT,
    is_redacted BOOLEAN DEFAULT FALSE
);

INSERT INTO florida_parcels (parcel_id, phy_addr1, phy_city, phy_zipcd, owner_name, taxable_value) VALUES
('064210010010', '3930 SW 53 CT', 'DAVIE', '33314', 'JOHN DOE', 450000),
('064210010011', '3931 SW 53 CT', 'DAVIE', '33314', 'JANE SMITH', 475000);
                            </pre>`;
                    }
                } else {
                    statusDiv.innerHTML = `✅ Table exists with ${data.length} records`;
                    resultsDiv.innerHTML = '<h2>Sample Data:</h2><ul>';
                    data.forEach(item => {
                        resultsDiv.innerHTML += `<li>${item.parcel_id}: ${item.phy_addr1}, ${item.phy_city} (Owner: ${item.owner_name})</li>`;
                    });
                    resultsDiv.innerHTML += '</ul>';
                    
                    // Test 2: Search for specific address
                    const searchResult = await supabaseClient
                        .from('florida_parcels')
                        .select('*')
                        .ilike('phy_addr1', '%3930 SW 53%');
                    
                    if (searchResult.data && searchResult.data.length > 0) {
                        resultsDiv.innerHTML += `<h2>✅ Found address "3930 SW 53":</h2>`;
                        resultsDiv.innerHTML += `<pre>${JSON.stringify(searchResult.data[0], null, 2)}</pre>`;
                    } else {
                        resultsDiv.innerHTML += `<h2>⚠️ No results for "3930 SW 53"</h2>`;
                    }
                }
            } catch (err) {
                statusDiv.innerHTML = `❌ Connection error: ${err.message}`;
            }
        }
        
        // Run test on page load
        testConnection();
    </script>
</body>
</html>