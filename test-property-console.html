<!DOCTYPE html>
<html>
<head>
    <title>Property Data Debug Test</title>
</head>
<body>
    <h1>Property Data Debug Test</h1>
    <p>Check browser console for logs</p>

    <script>
        console.log('=== Starting Property Data Debug ===');

        // Simulate PropertyService sample data
        const sampleProperties = [
            {
                parcel_id: '064210010010',
                phy_addr1: '123 Main Street',
                phy_city: 'Fort Lauderdale',
                phy_zipcd: '33301',
                own_name: 'John Smith',
                jv: 450000,
                lnd_val: 180000,
                tot_lvg_area: 2200,
                lnd_sqfoot: 8500,
                act_yr_blt: 2005,
                dor_uc: '001',
                county: 'BROWARD'
            },
            {
                parcel_id: '064210020030',
                phy_addr1: '456 Oak Avenue',
                phy_city: 'Hollywood',
                phy_zipcd: '33020',
                own_name: 'Jane Doe',
                jv: 320000,
                lnd_val: 120000,
                tot_lvg_area: 1800,
                lnd_sqfoot: 7200,
                act_yr_blt: 1998,
                dor_uc: '001',
                county: 'BROWARD'
            }
        ];

        console.log('PropertyService.filterSampleData - Using sample data with filters:', {});
        console.log('PropertyService.filterSampleData - Sample properties before filtering:', sampleProperties);
        console.log('PropertyService.filterSampleData - First sample property jv value:', sampleProperties[0]?.jv);

        const result = {
            properties: sampleProperties,
            total: sampleProperties.length
        };

        console.log('PropertyService.filterSampleData - Returning sample data result:', result);
        console.log('PropertyService.filterSampleData - First property data:', result.properties[0]);
        console.log('PropertyService.filterSampleData - First property jv field specifically:', result.properties[0]?.jv);

        // Simulate PropertySearchRestored receiving data
        console.log('PropertySearchRestored - searchProperties result:', result);
        console.log('PropertySearchRestored - first property from result:', result.properties[0]);
        console.log('PropertySearchRestored - first property jv field:', result.properties[0]?.jv);

        // Simulate rendering each property
        result.properties.forEach((property, index) => {
            console.log(`PropertySearchRestored - rendering property ${index}:`, property);
            console.log(`PropertySearchRestored - property ${index} jv field:`, property.jv);

            // Simulate MiniPropertyCard receiving data
            console.log('MiniPropertyCard data received:', property);
            console.log('Specific jv value:', property.jv);

            // Simulate getAppraisedValue function
            const getAppraisedValue = (data) => {
                const value = data.jv || data.just_value || data.appraised_value || data.market_value || data.assessed_value;
                console.log('getAppraisedValue checking fields:', {
                    jv: data.jv,
                    just_value: data.just_value,
                    appraised_value: data.appraised_value,
                    market_value: data.market_value,
                    assessed_value: data.assessed_value,
                    final_value: value
                });
                return value;
            };

            const appraisedValue = getAppraisedValue(property);

            // Simulate formatCurrency function
            const formatCurrency = (value) => {
                console.log('MiniPropertyCard.formatCurrency called with value:', value, 'type:', typeof value);
                console.log('MiniPropertyCard.formatCurrency value is falsy:', !value);
                console.log('MiniPropertyCard.formatCurrency value == 0:', value == 0);
                console.log('MiniPropertyCard.formatCurrency value === 0:', value === 0);
                console.log('MiniPropertyCard.formatCurrency value === undefined:', value === undefined);
                console.log('MiniPropertyCard.formatCurrency value === null:', value === null);

                if (!value && value !== 0) return 'N/A';
                if (value >= 1000000000) {
                    return `$${(value / 1000000000).toFixed(1)}B`;
                }
                if (value >= 1000000) {
                    return `$${(value / 1000000).toFixed(1)}M`;
                }
                if (value >= 1000) {
                    return `$${(value / 1000).toFixed(0)}K`;
                }
                return `$${value}`;
            };

            const formattedValue = formatCurrency(appraisedValue);
            console.log(`Property ${index} final formatted value:`, formattedValue);
            console.log('---');
        });

        console.log('=== Debug completed ===');

        // Display results on page
        document.body.innerHTML += '<h2>Results</h2>';
        result.properties.forEach((property, index) => {
            const getAppraisedValue = (data) => {
                return data.jv || data.just_value || data.appraised_value || data.market_value || data.assessed_value;
            };

            const formatCurrency = (value) => {
                if (!value && value !== 0) return 'N/A';
                if (value >= 1000000000) return `$${(value / 1000000000).toFixed(1)}B`;
                if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
                if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
                return `$${value}`;
            };

            const appraisedValue = getAppraisedValue(property);
            const formattedValue = formatCurrency(appraisedValue);

            document.body.innerHTML += `
                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                    <h3>Property ${index + 1}: ${property.phy_addr1}</h3>
                    <p><strong>Owner:</strong> ${property.own_name}</p>
                    <p><strong>Raw jv value:</strong> ${property.jv}</p>
                    <p><strong>getAppraisedValue result:</strong> ${appraisedValue}</p>
                    <p><strong>formatCurrency result:</strong> ${formattedValue}</p>
                    <p style="color: ${formattedValue === 'N/A' ? 'red' : 'green'};">
                        <strong>Final display:</strong> ${formattedValue}
                    </p>
                </div>
            `;
        });
    </script>
</body>
</html>