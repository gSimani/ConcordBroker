# Railway Configuration for Search Services

[build]
builder = "NIXPACKS"

[deploy]
startCommand = "python apps/api/search_api.py"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "meilisearch"
image = "getmeili/meilisearch:v1.6"

[services.environmentVariables]
MEILI_ENV = "production"
MEILI_MASTER_KEY = "${{MEILI_MASTER_KEY}}"
MEILI_HTTP_PAYLOAD_SIZE_LIMIT = "104857600"  # 100MB

[services.volumes]
"/meili_data" = "meili-data"

[services.healthcheck]
path = "/health"
port = 7700
interval = 30
timeout = 10
retries = 3

[services.resources]
memory = 2048  # 2GB RAM
cpus = 1

[[services]]
name = "search-api"
build.context = "."
build.dockerfile = "Dockerfile.search"

[services.environmentVariables]
MEILISEARCH_URL = "${{MEILISEARCH_INTERNAL_URL}}"
MEILISEARCH_KEY = "${{MEILI_MASTER_KEY}}"
SUPABASE_URL = "${{SUPABASE_URL}}"
SUPABASE_SERVICE_ROLE_KEY = "${{SUPABASE_SERVICE_ROLE_KEY}}"

[services.healthcheck]
path = "/health"
port = 8001
interval = 30
timeout = 10
retries = 3

[services.resources]
memory = 512  # 512MB RAM
cpus = 0.5
