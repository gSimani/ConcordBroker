<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Data Quality Dashboard - ConcordBroker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .quality-meter {
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 33%, #10b981 66%, #10b981 100%);
            height: 8px;
            border-radius: 4px;
            position: relative;
        }
        .quality-indicator {
            position: absolute;
            top: -20px;
            transform: translateX(-50%);
            font-weight: bold;
            font-size: 24px;
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">Property Data Quality Dashboard</h1>
                    <p class="text-gray-600">Real-time monitoring of 9.1M Florida properties across 100+ property types</p>
                </div>
                <div class="flex gap-4 items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full pulse-dot"></div>
                        <span class="text-sm text-gray-600">Live Data</span>
                    </div>
                    <button onclick="refreshData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Refresh
                    </button>
                    <button onclick="exportToCSV()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Export CSV
                    </button>
                </div>
            </div>
            <div class="mt-2 text-sm text-gray-500" id="lastUpdate">Last updated: <span id="updateTime">Loading...</span></div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="flex justify-center items-center h-64">
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Loading data quality metrics...</p>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" class="hidden">
            <!-- Summary Stats Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                <!-- Total Properties -->
                <div class="stat-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">Total Properties</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="totalProperties">0</div>
                    <p class="text-xs text-gray-500 mt-1">All Florida parcels</p>
                </div>

                <!-- NULL Count -->
                <div class="stat-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">NULL Values</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-red-600" id="nullCount">0</div>
                    <p class="text-xs text-gray-500 mt-1">Unclassified properties</p>
                </div>

                <!-- NULL Percentage -->
                <div class="stat-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">NULL Percentage</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="text-3xl font-bold" id="nullPercentage">0%</div>
                    <p class="text-xs text-gray-500 mt-1">Target: &lt; 5%</p>
                </div>

                <!-- Unique Types -->
                <div class="stat-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">Unique Types</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-purple-600" id="uniqueTypes">0</div>
                    <p class="text-xs text-gray-500 mt-1">Property classifications</p>
                </div>

                <!-- Quality Score -->
                <div class="stat-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">Quality Score</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="text-3xl font-bold" id="qualityScore">0</div>
                    <p class="text-xs text-gray-500 mt-1">Out of 100</p>
                </div>
            </div>

            <!-- Quality Meter -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Overall Data Quality</h2>
                <div class="relative pt-6">
                    <div class="quality-meter">
                        <div id="qualityIndicator" class="quality-indicator" style="left: 50%;">50</div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-gray-600">
                        <span>Poor (0-60)</span>
                        <span>Fair (60-75)</span>
                        <span>Good (75-90)</span>
                        <span>Excellent (90-100)</span>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-gray-700" id="qualityMessage">Loading quality assessment...</p>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Property Type Distribution (Pie Chart) -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Property Type Distribution</h2>
                    <div class="relative" style="height: 400px;">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>

                <!-- Top 20 Property Types (Bar Chart) -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Top 20 Property Types</h2>
                    <div class="relative" style="height: 400px;">
                        <canvas id="topTypesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Missing Mappings Table -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Missing or Unusual Mappings</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Property Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="missingMappingsTable">
                            <tr>
                                <td colspan="3" class="px-6 py-4 text-center text-gray-500">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Changes Timeline -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Recent Changes Timeline</h2>
                <div id="changesTimeline" class="space-y-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-2 h-2 mt-2 bg-blue-500 rounded-full"></div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-900">Dashboard initialized</p>
                            <p class="text-xs text-gray-500" id="initTime">Just now</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let distributionChart = null;
        let topTypesChart = null;
        let currentData = null;
        // Try multiple API ports - 8000 (default) or 8001 (dedicated data quality server)
        const API_PORTS = [8000, 8001];
        let API_BASE_URL = null;
        let autoRefreshInterval = null;

        // Find working API server
        async function findAPIServer() {
            for (const port of API_PORTS) {
                const url = `http://localhost:${port}`;
                try {
                    const response = await fetch(`${url}/health`, { signal: AbortSignal.timeout(2000) });
                    if (response.ok) {
                        console.log(`✅ Found API server on port ${port}`);
                        return url;
                    }
                } catch (e) {
                    console.log(`❌ Port ${port} not available`);
                }
            }
            return null;
        }

        // Initialize dashboard
        async function initDashboard() {
            console.log('Initializing Property Data Quality Dashboard...');
            document.getElementById('initTime').textContent = new Date().toLocaleString();

            // Find API server
            API_BASE_URL = await findAPIServer();

            if (!API_BASE_URL) {
                document.getElementById('loadingState').innerHTML = `
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-gray-600 mb-4">No API server found</p>
                        <p class="text-sm text-gray-500 mb-4">Please start the production property API:</p>
                        <code class="bg-gray-100 px-4 py-2 rounded text-sm">python production_property_api.py</code>
                        <br><br>
                        <button onclick="initDashboard()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Retry Connection
                        </button>
                    </div>
                `;
                return;
            }

            // Load data
            await refreshData();

            // Set up auto-refresh every 5 minutes
            autoRefreshInterval = setInterval(refreshData, 5 * 60 * 1000);

            console.log('Dashboard initialized successfully');
        }

        // Refresh all data
        async function refreshData() {
            console.log('Refreshing data...');

            try {
                const response = await fetch(`${API_BASE_URL}/api/properties/data-quality`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                currentData = data;

                console.log('Data received:', data);

                // Update UI
                updateSummaryStats(data.summary);
                updateQualityMeter(data.summary.quality_score);
                updateCharts(data.property_type_distribution);
                updateMissingMappings(data.missing_mappings);
                addTimelineEvent('Data refreshed successfully');

                // Hide loading, show content
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('dashboardContent').classList.remove('hidden');

                // Update timestamp
                const now = new Date();
                document.getElementById('updateTime').textContent = now.toLocaleString();

            } catch (error) {
                console.error('Error fetching data:', error);
                addTimelineEvent(`Error: ${error.message}`, 'error');

                // Show error message
                if (document.getElementById('loadingState').classList.contains('hidden')) {
                    alert('Failed to refresh data. Please check if the API server is running on port 8000.');
                } else {
                    document.getElementById('loadingState').innerHTML = `
                        <div class="text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="text-gray-600 mb-4">Failed to load data quality metrics</p>
                            <p class="text-sm text-gray-500 mb-4">Error: ${error.message}</p>
                            <button onclick="refreshData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Try Again
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Update summary statistics
        function updateSummaryStats(summary) {
            document.getElementById('totalProperties').textContent = summary.total_properties.toLocaleString();
            document.getElementById('nullCount').textContent = summary.null_count.toLocaleString();

            const nullPercentageEl = document.getElementById('nullPercentage');
            nullPercentageEl.textContent = `${summary.null_percentage.toFixed(1)}%`;
            nullPercentageEl.className = summary.null_percentage > 5 ? 'text-3xl font-bold text-red-600' : 'text-3xl font-bold text-green-600';

            document.getElementById('uniqueTypes').textContent = summary.unique_types.toLocaleString();

            const qualityScoreEl = document.getElementById('qualityScore');
            qualityScoreEl.textContent = summary.quality_score.toFixed(1);
            qualityScoreEl.className = getQualityScoreClass(summary.quality_score);
        }

        // Get CSS class for quality score
        function getQualityScoreClass(score) {
            if (score >= 90) return 'text-3xl font-bold text-green-600';
            if (score >= 75) return 'text-3xl font-bold text-blue-600';
            if (score >= 60) return 'text-3xl font-bold text-yellow-600';
            return 'text-3xl font-bold text-red-600';
        }

        // Update quality meter
        function updateQualityMeter(score) {
            const indicator = document.getElementById('qualityIndicator');
            indicator.textContent = score.toFixed(1);
            indicator.style.left = `${score}%`;

            // Update message
            const message = document.getElementById('qualityMessage');
            if (score >= 90) {
                message.innerHTML = '<strong>Excellent!</strong> Data quality is outstanding. Property type mappings are comprehensive and accurate.';
                message.className = 'text-sm text-green-700 bg-green-50 p-4 rounded-lg';
            } else if (score >= 75) {
                message.innerHTML = '<strong>Good</strong> - Data quality is solid. Minor improvements possible in type mapping coverage.';
                message.className = 'text-sm text-blue-700 bg-blue-50 p-4 rounded-lg';
            } else if (score >= 60) {
                message.innerHTML = '<strong>Fair</strong> - Data quality needs improvement. Focus on reducing NULL values and improving type mappings.';
                message.className = 'text-sm text-yellow-700 bg-yellow-50 p-4 rounded-lg';
            } else {
                message.innerHTML = '<strong>Poor</strong> - Significant data quality issues detected. Immediate action required to improve mappings and reduce NULL values.';
                message.className = 'text-sm text-red-700 bg-red-50 p-4 rounded-lg';
            }
        }

        // Update charts
        function updateCharts(typeDistribution) {
            // Prepare data - take top 10 for pie, top 20 for bar
            const top10 = typeDistribution.slice(0, 10);
            const top20 = typeDistribution.slice(0, 20);

            // Pie chart colors
            const pieColors = [
                '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',
                '#ec4899', '#14b8a6', '#f97316', '#06b6d4', '#84cc16'
            ];

            // Destroy existing charts
            if (distributionChart) distributionChart.destroy();
            if (topTypesChart) topTypesChart.destroy();

            // Create pie chart
            const pieCtx = document.getElementById('distributionChart').getContext('2d');
            distributionChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: top10.map(t => t.type),
                    datasets: [{
                        data: top10.map(t => t.count),
                        backgroundColor: pieColors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: { size: 11 },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => {
                                        const value = data.datasets[0].data[i];
                                        const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return {
                                            text: `${label} (${percentage}%)`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            hidden: false,
                                            index: i
                                        };
                                    });
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const count = context.parsed.toLocaleString();
                                    const percentage = top10[context.dataIndex].percentage.toFixed(2);
                                    return `${context.label}: ${count} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Create bar chart
            const barCtx = document.getElementById('topTypesChart').getContext('2d');
            topTypesChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: top20.map(t => t.type.length > 20 ? t.type.substring(0, 20) + '...' : t.type),
                    datasets: [{
                        label: 'Property Count',
                        data: top20.map(t => t.count),
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const count = context.parsed.x.toLocaleString();
                                    const percentage = top20[context.dataIndex].percentage.toFixed(2);
                                    return `Count: ${count} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update missing mappings table
        function updateMissingMappings(mappings) {
            const tbody = document.getElementById('missingMappingsTable');

            if (mappings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-4 text-center text-gray-500">No missing mappings detected</td></tr>';
                return;
            }

            tbody.innerHTML = mappings.map(m => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${m.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${m.count.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-orange-600">${m.issue}</td>
                </tr>
            `).join('');
        }

        // Add timeline event
        function addTimelineEvent(message, type = 'info') {
            const timeline = document.getElementById('changesTimeline');
            const color = type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const timestamp = new Date().toLocaleString();

            const event = document.createElement('div');
            event.className = 'flex items-start';
            event.innerHTML = `
                <div class="flex-shrink-0 w-2 h-2 mt-2 ${color} rounded-full"></div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">${message}</p>
                    <p class="text-xs text-gray-500">${timestamp}</p>
                </div>
            `;

            // Add to top of timeline
            timeline.insertBefore(event, timeline.firstChild);

            // Keep only last 10 events
            while (timeline.children.length > 10) {
                timeline.removeChild(timeline.lastChild);
            }
        }

        // Export to CSV
        function exportToCSV() {
            if (!currentData) {
                alert('No data available to export. Please wait for data to load.');
                return;
            }

            const rows = [];

            // Header
            rows.push(['Property Type', 'Count', 'Percentage'].join(','));

            // Data
            currentData.property_type_distribution.forEach(item => {
                rows.push([
                    `"${item.type}"`,
                    item.count,
                    item.percentage.toFixed(2)
                ].join(','));
            });

            // Create CSV content
            const csvContent = rows.join('\n');

            // Download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);

            link.setAttribute('href', url);
            link.setAttribute('download', `property-data-quality-${timestamp}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            addTimelineEvent('Data exported to CSV');
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initDashboard);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>
